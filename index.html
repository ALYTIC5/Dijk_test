<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" href="./src/css/style.css" media="all"/>
	<title>Dijk van een Wijf | Verhalen en wijsheden over natuur en tijd</title>
	<meta name="description" content="Ga in gesprek met het Wad en ontdek eeuwenoude verhalen, wijsheden over de natuur en inspirerende inzichten. Stel je vragen en laat je meenemen op een onvergetelijke reis door de tijd en natuur."/>
	<meta name="keywords" content="gesprek met het Wad, natuur verhalen, wijsheden van het Wad, interactief gesprek, tijd en natuur, het Wad, stem van het Wad, Wad inspiratie, vragen stellen over natuur, eeuwenoude verhalen"/>
	<meta name="robots" content="index,follow"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
	<link rel="shortcut icon" href="favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
	<meta name="apple-mobile-web-app-title" content="Dijk van een Wijf" />
	<link rel="manifest" href="/assets/favicon/site.webmanifest" />
</head>
<body class="page page--home">
<main>
	<article>
		<section>
			<div class="relative container pt-8 pb-14 mb-10 z-10">
				<div class="relative">
					<div class="relative z-10">
						<div class="flex justify-between items-center">
							<a href="/introduction.html">
								<figure>
									<img src="./assets/img/dijk-van-een-wijf-logo.png" alt="Ga naar de homepagina">
								</figure>
							</a>
						</div>
						<h1>Ontdek het Wad.</h1>
						<p class="font-semibold text-pretty">Hier, aan de voet van Dijk van een Wijf, start jouw reis. Luister naar de introductie en ga daarna in gesprek met het Wad.</p>
						<p class="text-pretty">Via de microfoon van je telefoon kun je al je vragen stellen; over het kunstwerk, over het Wad, de planten en dieren. Laat je meevoeren in alle, soms eeuwenoude, verhalen
							van dit unieke gebied.</p>
						<!-- Changed to button-like link we intercept to start audio + load intro content -->
						<a href="/introduction.html" id="btn-nl" class="btn btn--headset group" title="Luister naar het Wad">
							<span>Luister naar het Wad</span>
							<i class="icon-headset text-[22px] group-hover:ml-2"></i>
						</a>
					</div>
				</div>
			</div>

			<div class="container">
				<div class="flex flex-col items-start gap-2.5">
					<a href="/introduction_en.html" class="btn btn--white btn--small" title="Listen to the Wad">
						<figure class="size-5 rounded-full overflow-hidden grayscale">
							<img class="w-full h-full object-cover object-center" src="./assets/img/united-kingdom-flag-icon.svg" alt="Engelse vlag"/>
						</figure>
						<span>Listen to the Wad</span>
						<i class="icon-headset"></i>
					</a>
					<a href="/introduction_fy.html" class="btn btn--white btn--small" title="Harkje nei it Waad">
						<i class="icon-fryslan"></i>
						<span>Harkje nei it Waad</span>
						<i class="icon-headset"></i>
					</a>
				</div>
			</div>
		</section>
		<div class="absolute bg-cover right-1/2 top-5 -translate-x-1/2 bg-[url(../../assets/img/backgrounds/bg-white-blob.svg)] bg-no-repeat w-[720px] left-[calc(28%)] sm:left-[calc(49%)] sm:w-[500px] h-[636px]"></div>
	</article>
</main>

<!-- Hidden audio elements (index is silent until click) -->
<audio id="bgAudio" loop preload="auto" playsinline></audio>
<audio id="introAudio" preload="auto" playsinline></audio>

<script>
  // === Audio file paths (relative to this page) ===
  const SEASON_TRACKS = [
    "./assets/audio/Soundscapes - Lente - Dijk van een Wijf V2.mp3",
    "./assets/audio/Soundscapes - Zommer - Dijk van een Wijf V2.mp3",
    "./assets/audio/Soundscapes - Herfst - Dijk van een Wijf V2.mp3",
    "./assets/audio/Soundscapes - Winter - Dijk van een Wijf V2.mp3"
  ];
  // First part of the Dutch intro voice
  const INTRO_NL = "./assets/audio/DveW_Intro_NL_2 (silent intro).mp3";

  // === Seasonal selection by month ===
  function getSeasonIndex() {
    const m = new Date().getMonth(); // 0..11
    if (m >= 2 && m <= 4) return 0;   // Lente (Mar–May)
    if (m >= 5 && m <= 7) return 1;   // Zomer (Jun–Aug)
    if (m >= 8 && m <= 10) return 2;  // Herfst (Sep–Nov)
    return 3;                         // Winter (Dec–Feb)
  }

  const bgEl = document.getElementById("bgAudio");
  const introEl = document.getElementById("introAudio");

  // Web Audio graph for volume control (BG 20%, Voice 100%)
  let audioCtx, bgGain, voiceGain, graphReady = false;

  function ensureGraph() {
    if (graphReady) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    bgGain = audioCtx.createGain();
    voiceGain = audioCtx.createGain();
    bgGain.gain.value = 0.20;   // background at 20%
    voiceGain.gain.value = 1.00; // voice at 100%
    const bgSrc = audioCtx.createMediaElementSource(bgEl);
    const vSrc  = audioCtx.createMediaElementSource(introEl);
    bgSrc.connect(bgGain).connect(audioCtx.destination);
    vSrc.connect(voiceGain).connect(audioCtx.destination);
    graphReady = true;
  }

  // Replace only the <main> content with the fetched introduction page, keep audio running
  async function loadIntroductionIntoView() {
    try {
      const res = await fetch("./introduction.html", { credentials: "same-origin" });
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, "text/html");
      const newMain = doc.querySelector("main");
      if (newMain) {
        // update body class to match introduction page (keeps your styling)
        if (doc.body && doc.body.className) document.body.className = doc.body.className;
        // swap the main content
        const currentMain = document.querySelector("main");
        currentMain.innerHTML = newMain.innerHTML;
      }
      // reflect URL change without full reload
      history.pushState({}, "", "./introduction.html");
    } catch (e) {
      // If fetch fails, fall back to normal navigation
      window.location.href = "./introduction.html";
    }
  }

  // Start soundtrack + intro voice, then show the introduction page (without reloading)
  async function startDutchFlow() {
    ensureGraph();
    if (audioCtx.state === "suspended") {
      try { await audioCtx.resume(); } catch(e) {}
    }

    // start seasonal background
    bgEl.src = SEASON_TRACKS[getSeasonIndex()];
    bgEl.play().catch(()=>{});

    // start first part of Dutch intro voice
    introEl.src = INTRO_NL;
    introEl.play().catch(()=>{});

    // load the introduction page content and update the URL
    await loadIntroductionIntoView();
  }

  // Intercept the Dutch CTA
  document.getElementById("btn-nl").addEventListener("click", function (e) {
    e.preventDefault();
    startDutchFlow();
  });
</script>
</body>
</html>
